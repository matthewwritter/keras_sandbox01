digraph G {
label="Variational AutoEncoder (VAE)"N
splines=polyline
node [shape=cds style=filled fillcolor=gray]

subgraph cluster_enc {
    subgraph cluster_enc {
        label = output
        color = black
        z_mean; z_var; z_sampled
    }

    label = encoder
    color = black
    {indexed w2v} -> embedding -> flattened -> dense_layers_enc -> {z_mean z_var} -> z_sampled

}

subgraph cluster_dec {
    label = decoder
    color = black
    dense_layers_dec -> reshape_dec
}

label01 [label="OPTIMIZATION LOOP\nreconstruction_loss = mse(K.flatten(flattened), K.flatten(outputs)" shape=note style=filled fillcolor=yellow]

flattened -> label01 -> reshape_dec [arrowhead=none style=dashed label="Same dims"]

z_sampled -> dense_layers_dec

}